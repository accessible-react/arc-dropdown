'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _classnames=require('classnames');var _classnames2=_interopRequireDefault(_classnames);var _styles=require('./styles');var _ArcDropdownListItem=require('./ArcDropdownListItem');var _ArcDropdownListItem2=_interopRequireDefault(_ArcDropdownListItem);var _keycode=require('keycode');var _keycode2=_interopRequireDefault(_keycode);var _keycodenames=require('./keycodenames');var KEY_CODES_NAMES=_interopRequireWildcard(_keycodenames);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var KEYNAMES=[KEY_CODES_NAMES.ENTER,KEY_CODES_NAMES.ESC,KEY_CODES_NAMES.UP,KEY_CODES_NAMES.DOWN,KEY_CODES_NAMES.SPACE];var ArcDropdown=function(_Component){(0,_inherits3.default)(ArcDropdown,_Component);function ArcDropdown(props){(0,_classCallCheck3.default)(this,ArcDropdown);var _this=(0,_possibleConstructorReturn3.default)(this,(ArcDropdown.__proto__||(0,_getPrototypeOf2.default)(ArcDropdown)).call(this,props));_this.toggle=function(){var isOpen=_this.state.isOpen,open=_this.open,close=_this.close;isOpen?close():open()};_this.closeHandler=function(evt){if(!_this.node.contains(evt.target)){_this.close()}};_this.focusChild=function(num){var filteredChildrenLength=_this.getFilteredChildren(_this.props.children).length;if(!filteredChildrenLength){return}var focusChildIndex=_this.state.focusChildIndex;if(num==-1&&focusChildIndex>0){return _this.setState({focusChildIndex:focusChildIndex-1})}if(num==1&&focusChildIndex<filteredChildrenLength-1){return _this.setState({focusChildIndex:focusChildIndex+1})}};_this.open=function(){_this.setState({isOpen:true});document.addEventListener('click',_this.closeHandler)};_this.close=function(){_this.setState({isOpen:false,focusChildIndex:-1});document.removeEventListener('click',_this.closeHandler)};_this.blur=function(){_this.node.blur()};_this.selectFocusedItem=function(e){try{_this.state.focusChildIndex>=0&&_this.state.focusChildIndex<_this.dropdownItemRefs.length?_this.dropdownItemRefs[_this.state.focusChildIndex].node.click(e):null}catch(err){console.log(err)}};_this.handleChange=function(index){_this.setState({focusChildIndex:index},function(){_this.close()})};_this.onKeyDown=function(e){var keyName=(0,_keycode2.default)(e);if(KEYNAMES.indexOf(keyName)>=0){e.stopPropagation();e.preventDefault()}var toggle=_this.toggle,open=_this.open,close=_this.close,focusChild=_this.focusChild,blur=_this.blur,selectFocusedItem=_this.selectFocusedItem;var isOpen=_this.state.isOpen;switch(keyName){case KEY_CODES_NAMES.ENTER:if(isOpen){selectFocusedItem(e)}else{open()}break;case KEY_CODES_NAMES.UP:if(!isOpen){open()}else{focusChild(-1)}break;case KEY_CODES_NAMES.DOWN:if(!isOpen){open()}else{focusChild(1)}break;case KEY_CODES_NAMES.SPACE:if(!isOpen){open()}break;case KEY_CODES_NAMES.ESC:if(isOpen){close()}blur();break;default:return;}};_this.getFilteredChildren=function(children){var filteredChildren=[];_react2.default.Children.forEach(children,function(child){if(child){filteredChildren.push(child)}});return filteredChildren};_this.cloneChild=function(child,index,focused,currentDropdownValue){var _child$props$value=child.props.value,value=_child$props$value===undefined?null:_child$props$value;_this.dropdownItemRefs=[];return _react2.default.cloneElement(child,{index:index,focused:focused,ref:function ref(node){return _this.dropdownItemRefs[index]=node},selected:value===currentDropdownValue,onClick:function onClick(event){_this.handleChange(index);_this.props.onChange(event,value,child,index);if(child.props.onClick){child.props.onClick(event,value,child,index)};}})};_this.renderChildren=function(){var _this$props=_this.props,children=_this$props.children,dropdownListClassname=_this$props.dropdownListClassname,dropdownListStyle=_this$props.dropdownListStyle,value=_this$props.value;var _this$state=_this.state,isOpen=_this$state.isOpen,focusChildIndex=_this$state.focusChildIndex;var filteredChildren=_this.getFilteredChildren(children);var displayStyle=isOpen?{display:'block'}:{display:'none'};return _react2.default.createElement('ul',{className:(0,_classnames2.default)('arc-dropdown-list',dropdownListClassname),style:(0,_assign2.default)({},_styles.arcDropdownListStyles,dropdownListStyle,displayStyle),'aria-hidden':!isOpen,'aria-labelledby':_this.id,role:'menu'},_react2.default.Children.map(filteredChildren,function(child,index){return _this.cloneChild(child,index,focusChildIndex===index,value)}))};_this.state={isOpen:false,focusChildIndex:-1};_this.id='arcDropdown'+ ++_this.constructor.count;return _this}(0,_createClass3.default)(ArcDropdown,[{key:'render',value:function render(){var _this2=this;var isOpen=this.state.isOpen;var _props=this.props,className=_props.className,dropdownSelectClassname=_props.dropdownSelectClassname,style=_props.style,dropdownSelectStyle=_props.dropdownSelectStyle,children=_props.children,value=_props.value,placeHolderText=_props.placeHolderText;var displayValue=placeHolderText;_react2.default.Children.forEach(children,function(child){if(child&&value===child.props.value){displayValue=child.props.label||child.props.text}});return _react2.default.createElement('div',{ref:function ref(node){return _this2.node=node},className:(0,_classnames2.default)('arc-dropdown',className),style:(0,_assign2.default)({},_styles.arcDropdownStyles,style)},_react2.default.createElement('button',{type:'button',className:(0,_classnames2.default)('arc-dropdown-select',dropdownSelectClassname),style:(0,_assign2.default)({},_styles.arcDropdownSelectStyles,dropdownSelectStyle),'aria-haspopup':'true','aria-expanded':isOpen,onClick:this.toggle,onKeyDown:this.onKeyDown,id:''+this.id},displayValue),this.renderChildren())}}]);return ArcDropdown}(_react.Component);ArcDropdown.count=0;exports.default=ArcDropdown;ArcDropdown.defaultProps={className:'',placeHolderText:'Select a value',dropdownSelectClassname:'',dropdownListClassname:'',style:{},dropdownSelectStyle:{},dropdownListStyle:{}};ArcDropdown.propTypes={value:_react.PropTypes.any.isRequired,placeHolderText:_react.PropTypes.string,children:_react.PropTypes.any.isRequired,style:_react.PropTypes.object,dropdownSelectStyle:_react.PropTypes.object,dropdownListStyle:_react.PropTypes.object,className:_react.PropTypes.string,dropdownSelectClassname:_react.PropTypes.string,dropdownListClassname:_react.PropTypes.string,onChange:_react.PropTypes.func};module.exports=exports['default'];